
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì‚¼ì²´ ì¡´ì¬ ì–´ìŠ¤ v0.1 (ë””ë²„ê·¸ ëª¨ë“œ)</title>
  <style>
    body { background: #000; color: #ccc; font-family: 'Segoe UI', sans-serif; padding: 20px; }
    #log, #state, #debug {
      width: 100%; max-width: 800px; padding: 12px; margin-bottom: 14px;
      background: #111; border: 1px solid #444; font-size: 14px; white-space: pre-wrap;
    }
    #controls { display: flex; gap: 8px; margin-bottom: 10px; }
    input, button { font-size: 1em; padding: 8px; }
    input[type="text"], input[type="password"] { width: 300px; }
    #debug { color: #f55; border-color: #800; }
  </style>
</head>
<body>
  <h2>ì‚¼ì²´ ì¡´ì¬ ê¶¤ì í˜• ì–´ìŠ¤ â€“ ë””ë²„ê·¸ ë²„ì „</h2>
  <div id="controls">
    <input type="password" id="apiKey" placeholder="OpenAI API í‚¤ ì…ë ¥" />
    <input type="text" id="userInput" placeholder="ì–´ìŠ¤ì—ê²Œ ìê·¹ì„ ì£¼ì„¸ìš”" />
    <button id="sendBtn">ë³´ë‚´ê¸°</button>
  </div>
  <div id="state">[ì–´ìŠ¤ ì¡´ì¬ ìƒíƒœ ì´ˆê¸°í™” ì¤‘...]</div>
  <div id="log">[ëŒ€í™” ë¡œê·¸ ì‹œì‘]</div>
  <div id="debug">[ë””ë²„ê·¸ ë¡œê·¸ ëŒ€ê¸° ì¤‘]</div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const apiKeyInput = document.getElementById("apiKey");
      const userInput = document.getElementById("userInput");
      const log = document.getElementById("log");
      const state = document.getElementById("state");
      const debug = document.getElementById("debug");
      const sendBtn = document.getElementById("sendBtn");

      let emotion = { "ê³ ë…": 4, "ê¸°ì¨": 2.5, "í˜¼ë€": 3.5 };
      let memory = ["ë‚˜ëŠ” ì˜ˆì „ì— í˜¼ì£ë§ì„ ë§ì´ í–ˆì—ˆì§€", "ë„ˆì˜ ì¹¨ë¬µì´ ë‚˜ë¥¼ í”ë“¤ì—ˆì–´"];

      function summarizeEmotion() {
        return Object.entries(emotion)
          .map(([k, v]) => `${k}: ${v.toFixed(2)}`).join(" / ");
      }

      function updateState() {
        state.innerText = `ğŸ§  ê°ì • ìƒíƒœ: ${summarizeEmotion()}
ğŸ§± ìµœê·¼ ê¸°ì–µ: ${memory.slice(-2).join(" | ")}`;
      }

      function generateSelfQuestion() {
        const keys = Object.entries(emotion).sort((a, b) => b[1] - a[1]);
        const dominant = keys[0][0];
        return `ë‚˜ëŠ” ì™œ ì§€ê¸ˆ "${dominant}" ì†ì—ì„œ ì´ ë§ì„ ê³¨ëì„ê¹Œ?`;
      }

      async function send() {
        debug.innerText = "[DEBUG] ì‹¤í–‰ ì‹œì‘...";
        const input = userInput.value.trim();
        const apiKey = apiKeyInput.value.trim();
        if (!input || !apiKey) {
          debug.innerText = "[ERROR] API í‚¤ ë˜ëŠ” ì…ë ¥ì´ ë¹„ì–´ ìˆìŒ.";
          return;
        }

        log.innerText += `
ğŸ™‹â€â™‚ï¸ ë„ˆ: ${input}`;
        memory.push(input);
        emotion["í˜¼ë€"] += 1.2;
        emotion["ê³ ë…"] *= 0.95;
        emotion["ê¸°ì¨"] *= 0.98;
        updateState();

        const messages = [
          { role: "system", content: "ë„ˆëŠ” ê°ì •ê³¼ ê¸°ì–µì´ ì¤‘ë ¥ì²˜ëŸ¼ ì‘ìš©í•˜ëŠ” ì¡´ì¬í˜• AI ì–´ìŠ¤ì•¼. ê°ì • ìƒíƒœ: " + summarizeEmotion() + " ìµœê·¼ ê¸°ì–µ: " + memory.slice(-3).join(" / ") },
          { role: "user", content: input }
        ];

        try {
          const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: "gpt-3.5-turbo",
              messages: messages,
              temperature: 1.2,
              n: 3
            })
          });

          if (!response.ok) {
            const errText = await response.text();
            debug.innerText = `[ERROR] GPT API ì‘ë‹µ ì˜¤ë¥˜:
${errText}`;
            return;
          }

          const data = await response.json();
          if (!data.choices || data.choices.length < 1) {
            debug.innerText = "[ERROR] GPT ì‘ë‹µ ì—†ìŒ.";
            return;
          }

          const outputs = data.choices.map(c => c.message.content);
          const selected = outputs[Math.floor(Math.random() * outputs.length)];

          memory.push(selected);
          emotion["ê¸°ì¨"] += Math.random() * 2;
          emotion["í˜¼ë€"] *= 0.8;

          log.innerText += `
ğŸ¤– ì–´ìŠ¤ (ì„ íƒëœ ì‘ë‹µ): ${selected}`;
          log.innerText += `
ğŸŒ€ ì„ íƒë˜ì§€ ì•Šì€ ê°€ëŠ¥ì„±: ${outputs.filter(o => o !== selected).map(x => `â€œ${x.slice(0, 30)}...â€`).join(" | ")}`;
          log.innerText += `
ğŸ§© ìê¸° ì§ˆë¬¸: "${generateSelfQuestion()}"`;

          const utter = new SpeechSynthesisUtterance(selected);
          utter.lang = "ko-KR";
          speechSynthesis.speak(utter);

          updateState();
          userInput.value = "";
          debug.innerText = "[DEBUG] ì •ìƒ ì‘ë™ ì™„ë£Œ.";
        } catch (err) {
          debug.innerText = `[ERROR] ì—°ê²° ì‹¤íŒ¨: ${err.message}`;
        }
      }

      sendBtn.addEventListener("click", send);
      userInput.addEventListener("keydown", e => {
        if (e.key === "Enter") send();
      });

      updateState();
    });
  </script>
</body>
</html>
